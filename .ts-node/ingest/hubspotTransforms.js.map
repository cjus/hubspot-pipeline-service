{"version":3,"file":"hubspotTransforms.js","sourceRoot":"","sources":["../../app/ingest/hubspotTransforms.ts"],"names":[],"mappings":"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","sourcesContent":["import { HubSpotDealRawPipeline, HubSpotDealPipeline, HubSpotDealRaw, HubSpotDeal } from \"./hubspotModels\";\n// Array of fake companies for obfuscating deal names\nconst FAKE_COMPANIES = [\n    \"Acme Corporation\", \"Global Dynamics\", \"TechNova Solutions\", \"Apex Industries\",\n    \"Summit Enterprises\", \"NextGen Systems\", \"Horizon Technologies\", \"Atlas Corp\",\n    \"Stellar Industries\", \"Phoenix Technologies\", \"Quantum Solutions\", \"Pinnacle Group\",\n    \"Velocity Systems\", \"Infinity Corp\", \"Zenith Technologies\", \"Catalyst Solutions\",\n    \"Nexus Enterprises\", \"Titan Industries\", \"Vortex Systems\", \"Eclipse Technologies\",\n    \"Fusion Corp\", \"Matrix Solutions\", \"Orbital Systems\", \"Spectrum Enterprises\",\n    \"Pulse Technologies\", \"Vertex Solutions\", \"Cosmos Industries\", \"Dynamo Corp\",\n    \"Element Systems\", \"Frontier Technologies\", \"Genesis Solutions\", \"Helix Corp\",\n    \"Impact Industries\", \"Kinetic Systems\", \"Lunar Technologies\", \"Meridian Corp\",\n    \"Nova Solutions\", \"Omega Industries\", \"Paradigm Systems\", \"Quantum Leap Corp\",\n    \"Radiant Technologies\", \"Synergy Solutions\", \"Turbo Industries\", \"Unity Corp\",\n    \"Vector Systems\", \"Wavelength Technologies\", \"Xerion Solutions\", \"Zenith Corp\"\n];\n// Deal types for variety\nconst DEAL_TYPES = [\n    \"Enterprise License\", \"Professional Services\", \"Annual Subscription\",\n    \"Implementation Project\", \"Support Contract\", \"Consulting Agreement\",\n    \"Software License\", \"Platform Migration\", \"Digital Transformation\",\n    \"Cloud Infrastructure\", \"Security Audit\", \"Data Analytics Project\"\n];\n// Check if data should be anonymized (defaults to false for real data)\nconst ANONYMIZE_DATA = process.env.ANONYMIZE_DATA === 'true';\n// Log the anonymization mode on startup\nconsole.log(`ðŸ”§ HubSpot Pipeline Mode: ${ANONYMIZE_DATA ? 'ANONYMIZED DATA (Demo/Public Safe)' : 'REAL DATA (Internal Use)'}`);\n// Helper function to generate deterministic random values based on deal ID\nconst getRandomFromId = (dealId: string, arrayLength: number): number => {\n    let hash = 0;\n    for (let i = 0; i < dealId.length; i++) {\n        const char = dealId.charCodeAt(i);\n        hash = ((hash << 5) - hash) + char;\n        hash = hash & hash; // Convert to 32bit integer\n    }\n    return Math.abs(hash) % arrayLength;\n};\n// Transform raw HubSpot deal events to processed/normalized deal events\nHubSpotDealRawPipeline.stream!.addTransform(HubSpotDealPipeline.stream!, async (rawDeal: HubSpotDealRaw): Promise<HubSpotDeal> => {\n    /**\n     * Transform HubSpot raw deal data to normalized format.\n     *\n     * Normal flow:\n     * 1. Extract and type properties from flexible HubSpot properties object\n     * 2. Convert string values to appropriate types\n     * 3. Calculate derived fields (isWon, isClosed, daysToClose)\n     * 4. Return normalized deal\n     *\n     * Error flow (DLQ):\n     * - If transformation fails, deal goes to dead letter queue\n     * - Enables monitoring, debugging, and retry strategies\n     */\n    const props = rawDeal.properties;\n    // Generate deal name based on anonymization flag\n    let dealName: string;\n    let amount: number;\n    if (ANONYMIZE_DATA) {\n        // Generate obfuscated deal information using fake companies\n        const companyIndex = getRandomFromId(rawDeal.id, FAKE_COMPANIES.length);\n        const dealTypeIndex = getRandomFromId(rawDeal.id + \"type\", DEAL_TYPES.length);\n        dealName = `${FAKE_COMPANIES[companyIndex]} - ${DEAL_TYPES[dealTypeIndex]}`;\n        // Ensure amount is always over 100K (between 100K and 5M)\n        const originalAmount = parseFloat(props.amount || \"0\") || 0;\n        const baseAmount = 100000; // 100K minimum\n        const multiplier = (getRandomFromId(rawDeal.id + \"amount\", 100) + 1) / 2; // 0.5 to 50\n        amount = baseAmount + (originalAmount > 0 ? Math.max(originalAmount, baseAmount * multiplier) : baseAmount * multiplier);\n        amount += 20001;\n    }\n    else {\n        // Use real HubSpot data\n        dealName = props.dealname || \"Untitled Deal\";\n        amount = parseFloat(props.amount || \"0\") || 0;\n    }\n    const currency = props.deal_currency_code || \"USD\";\n    const stage = props.dealstage || \"unknown\";\n    const stageLabel = props.dealstage_label || stage;\n    const pipeline = props.pipeline || \"default\";\n    const pipelineLabel = props.pipeline_label || pipeline;\n    // Parse dates with fallbacks - properties may be missing\n    const parseDate = (dateStr?: string): Date => {\n        if (!dateStr)\n            return new Date();\n        try {\n            return new Date(dateStr);\n        }\n        catch {\n            return new Date();\n        }\n    };\n    const createdAt = parseDate(props.createdate || undefined) || new Date(rawDeal.createdAt);\n    const lastModifiedAt = parseDate(props.hs_lastmodifieddate || undefined) || new Date(rawDeal.updatedAt);\n    const closeDate = props.closedate ? parseDate(props.closedate || undefined) : undefined;\n    // Extract owner and metrics - handle null values\n    const ownerId = props.hubspot_owner_id;\n    const stageProbability = parseFloat(props.hs_deal_stage_probability || \"0\") || 0;\n    // Calculate forecast and projected amounts based on anonymization\n    let forecastAmount: number;\n    let projectedAmount: number;\n    if (ANONYMIZE_DATA) {\n        forecastAmount = parseFloat(props.hs_forecast_amount || \"0\") || amount * (stageProbability / 100);\n        projectedAmount = parseFloat(props.hs_projected_amount || \"0\") || amount;\n    }\n    else {\n        forecastAmount = parseFloat(props.hs_forecast_amount || props.amount || \"0\") || 0;\n        projectedAmount = parseFloat(props.hs_projected_amount || props.amount || \"0\") || 0;\n    }\n    // Calculate deal status flags\n    const isWon = stage.toLowerCase().includes(\"won\") || stage.toLowerCase().includes(\"closed\");\n    const isClosed = isWon || stage.toLowerCase().includes(\"lost\") || stage.toLowerCase().includes(\"closed\");\n    // Calculate days to close if applicable\n    let daysToClose: number | undefined;\n    if (isClosed && closeDate) {\n        const diffTime = Math.abs(closeDate.getTime() - createdAt.getTime());\n        daysToClose = Math.ceil(diffTime / (1000 * 60 * 60 * 24));\n    }\n    // Extract contact and company associations\n    const associatedContacts = rawDeal.associations.contacts || [];\n    const associatedCompanies = rawDeal.associations.companies || [];\n    // Parse counts\n    const contactCount = parseInt(props.num_associated_contacts || \"0\") || associatedContacts.length;\n    const noteCount = parseInt(props.num_contacted_notes || \"0\") || 0;\n    // Separate custom properties (excluding standard HubSpot properties)\n    const standardProperties = new Set([\n        'dealname', 'amount', 'dealstage', 'pipeline', 'dealtype', 'closedate',\n        'createdate', 'hs_lastmodifieddate', 'hubspot_owner_id', 'amount_in_home_currency',\n        'hs_deal_stage_probability', 'dealstage_label', 'pipeline_label', 'deal_currency_code',\n        'hs_forecast_amount', 'hs_projected_amount', 'num_associated_contacts',\n        'num_contacted_notes', 'days_to_close'\n    ]);\n    const customProperties: Record<string, any> = {};\n    Object.entries(props).forEach(([key, value]) => {\n        if (!standardProperties.has(key) && value !== undefined && value !== null) {\n            customProperties[key] = value;\n        }\n    });\n    // Create the normalized deal\n    const result: HubSpotDeal = {\n        id: rawDeal.id,\n        dealName,\n        amount,\n        currency,\n        stage,\n        stageLabel,\n        pipeline,\n        pipelineLabel,\n        dealType: props.dealtype || undefined,\n        closeDate,\n        createdAt,\n        lastModifiedAt,\n        ownerId: ownerId || undefined,\n        stageProbability,\n        forecastAmount,\n        projectedAmount,\n        daysToClose,\n        isWon,\n        isClosed,\n        isArchived: rawDeal.archived,\n        contactCount,\n        noteCount,\n        associatedContacts,\n        associatedCompanies,\n        customProperties\n    };\n    console.log(`Processed HubSpot deal: ${dealName} (${rawDeal.id}) - ${stage} - $${amount} ${ANONYMIZE_DATA ? '[ANONYMIZED]' : '[REAL DATA]'}`);\n    return result;\n});\n// Add a streaming consumer to log raw HubSpot deal events\nconst printHubSpotDealEvent = (rawDeal: HubSpotDealRaw): void => {\n    let displayName: string;\n    if (ANONYMIZE_DATA) {\n        // Generate obfuscated name for logging consistency\n        const companyIndex = getRandomFromId(rawDeal.id, FAKE_COMPANIES.length);\n        const dealTypeIndex = getRandomFromId(rawDeal.id + \"type\", DEAL_TYPES.length);\n        displayName = `${FAKE_COMPANIES[companyIndex]} - ${DEAL_TYPES[dealTypeIndex]}`;\n    }\n    else {\n        displayName = rawDeal.properties.dealname || \"Untitled\";\n    }\n    console.log(\"Received HubSpot Deal event:\");\n    console.log(`  Deal ID: ${rawDeal.id}`);\n    console.log(`  Deal Name: ${displayName}`);\n    console.log(`  Amount: ${rawDeal.properties.amount || \"0\"}`);\n    console.log(`  Stage: ${rawDeal.properties.dealstage || \"unknown\"}`);\n    console.log(`  Updated: ${rawDeal.updatedAt}`);\n    console.log(`  Anonymized: ${ANONYMIZE_DATA ? 'Yes' : 'No'}`);\n    console.log(\"---\");\n};\n// Note: Consumer registration APIs may vary by Moose version. If available, register here.\n// DLQ consumer for handling failed transformations\n// Dead-letter handling is configured on the pipelines; hook specific consumers if supported by your Moose version.\n"]}